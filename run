#!/bin/python3
import os
import subprocess
import sys

day = None
if len(sys.argv) == 2: day = int(sys.argv[1])

compilers_to_extensions = {
    'py': 'python3',
    'go': 'go',
    'cpp': 'g++',
    'rs': 'rustc',
}

def run_python_solution():
    subprocess.run(["python3", "solution.py"])
def run_go_solution():
    subprocess.run(["go", "run", "solution.go"])
def run_compiled_solution(extension):
    compiler = compilers_to_extensions[extension]
    proc = subprocess.run([compiler, f"solution.{extension}", "-o", "solution"])
    if proc.returncode != 0: exit(proc.returncode)
    subprocess.run(["./solution"])

folders = sorted([file for file in os.listdir() if os.path.isdir(file) and file[0].isnumeric()])
def run_solution_in_folder(folder, day):
    name = folder.split("_")[1:]
    for j, word in enumerate(name): name[j] = word.capitalize()
    print(f"Day {day}: {' '.join(name)}")
    os.chdir(folder)
    if "solution.py" in os.listdir(): run_python_solution()
    elif "solution.go" in os.listdir(): run_go_solution()
    elif "solution.cpp" in os.listdir(): run_compiled_solution("cpp")
    elif "solution.rs" in os.listdir(): run_compiled_solution("rs")
    else:
        print(f"ERROR: could not find solution in folder {folder}")
        exit(1)
    os.chdir("..")
    print("-----")

print("AOC 2024 Solutions")
print("-----")
if day is None:
    for i, folder in enumerate(folders):
        run_solution_in_folder(folder, day=i+1)
else:
    folder = folders[day - 1]
    run_solution_in_folder(folder, day=day)