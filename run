#!/bin/python3
import os
import subprocess
import sys

day = None
if len(sys.argv) == 2: day = int(sys.argv[1])

folders = sorted([file for file in os.listdir() if os.path.isdir(file) and file[0].isnumeric()])
def run_solution_in_folder(folder, day):
    name = folder.split("_")[1:]
    for j, word in enumerate(name): name[j] = word.capitalize()
    print(f"Day {day}: {' '.join(name)}")
    os.chdir(folder)
    if "solution.py" in os.listdir(): subprocess.run(["python3", "solution.py"])
    elif "solution.cpp" in os.listdir():
        proc = subprocess.run(["g++", "solution.cpp", "-o", "solution"])
        if proc.returncode != 0: exit(proc.returncode)
        subprocess.run(["./solution"])
    elif "solution.rs" in os.listdir():
        proc = subprocess.run(["rustc", "solution.rs", "-o", "solution"])
        if proc.returncode != 0: exit(proc.returncode)
        subprocess.run(["./solution"])
    else:
        print("ERROR: could not find solution in folder")
        exit(1)
    os.chdir("..")
    print("-----")

print("AOC 2024 Solutions")
print("-----")
if day is None:
    for i, folder in enumerate(folders):
        run_solution_in_folder(folder, day=i+1)
else:
    folder = folders[day - 1]
    run_solution_in_folder(folder, day=day)